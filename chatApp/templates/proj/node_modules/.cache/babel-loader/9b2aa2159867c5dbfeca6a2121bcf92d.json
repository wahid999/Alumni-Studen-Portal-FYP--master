{"ast":null,"code":"import _classCallCheck from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{connect}from\"react-redux\";import WebSocketInstance from\"../websocket\";import Hoc from\"../hoc/hoc\";import Profile from\"./Profile\";import groupUser from'./../assets/groupUser.png';import singleUser from'./../assets/singleUser.png';import axios from\"axios\";var Chat=/*#__PURE__*/function(_React$Component){_inherits(Chat,_React$Component);var _super=_createSuper(Chat);_createClass(Chat,[{key:\"initialiseChat\",value:function initialiseChat(){var _this2=this;this.waitForSocketConnection(function(){// WebSocketInstance.addCallbacks(\n//   this.props.setMessages.bind(this),\n//   this.props.addMessage.bind(this)\n// );\nWebSocketInstance.fetchMessages(_this2.props.username,_this2.props.match.params.chatID);});WebSocketInstance.connect(this.props.match.params.chatID);}}]);function Chat(props){var _this;_classCallCheck(this,Chat);_this=_super.call(this,props);_this.state={message:\"\",value:''};_this.messageChangeHandler=function(event){_this.setState({message:event.target.value});};_this.sendMessageHandler=function(e){e.preventDefault();var messageObject={from:_this.props.username,content:_this.state.message,chatId:_this.props.match.params.chatID};WebSocketInstance.newChatMessage(messageObject);_this.setState({message:\"\"});};_this.renderTimestamp=function(timestamp){var prefix=\"\";var timeDiff=Math.round((new Date().getTime()-new Date(timestamp).getTime())/60000);if(timeDiff<1){// less than one minute ago\nprefix=\"just now...\";}else if(timeDiff<60&&timeDiff>1){// less than sixty minutes ago\nprefix=\"\".concat(timeDiff,\" minutes ago\");}else if(timeDiff<24*60&&timeDiff>60){// less than 24 hours ago\nprefix=\"\".concat(Math.round(timeDiff/60),\" hours ago\");}else if(timeDiff<31*24*60&&timeDiff>24*60){// less than 7 days ago\nprefix=\"\".concat(Math.round(timeDiff/(60*24)),\" days ago\");}else{}return prefix;};_this.getUserName=function(name){var index=name.lastIndexOf('@');name=name.substr(0,index)+'    @'+name.substr(index+1);return name;};_this.renderMessages=function(messages){var currentUser=_this.props.username;return messages.map(function(message,i,arr){return/*#__PURE__*/React.createElement(\"li\",{key:message.id,style:{marginBottom:arr.length-1===i?\"300px\":\"15px\"},className:message.author===currentUser?\"sent\":\"replies\"},/*#__PURE__*/React.createElement(\"p\",null,_this.getUserName(message.content),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"small\",null,_this.renderTimestamp(message.timestamp))));});};_this.scrollToBottom=function(){_this.messagesEnd.scrollIntoView({behavior:\"smooth\"});};_this.replaceAll=function(string,search,replace){return string.split(search).join(replace);};_this.getImageURL=function(name){var url='';var token=localStorage.getItem('token');axios.defaults.headers={\"Content-Type\":\"application/json\",Authorization:\"Token \".concat(token)};axios.get(\"http://127.0.0.1:8000/chat/profile/\".concat(name)).then(function(res){return res.data;}).then(function(res){_this.setState({value:res[0].photo_url});// url = res[0].photo_url\n}).catch();return _this.state.value;};_this.getImage=function(){var itemNO=_this.props.match.params.chatID.split('_').length;var name=_this.props.match.params.chatID;name=_this.replaceAll(name,'_',' ');var username=localStorage.getItem('username');if(username!==null&username!==undefined){username=localStorage.getItem('username').charAt(0).toUpperCase()+username.slice(1);}if(itemNO<=2){name=name.replace(username,'');name=_this.replaceAll(name,' ','');name=name.toLowerCase();name=_this.getImageURL(name);}else{name=groupUser;}if(name===undefined){name=singleUser;}return name;};_this.initialiseChat();return _this;}_createClass(Chat,[{key:\"waitForSocketConnection\",value:function waitForSocketConnection(callback){var component=this;setTimeout(function(){if(WebSocketInstance.state()===1){console.log(\"Connection is made\");callback();return;}else{console.log(\"wait for connection...\");component.waitForSocketConnection(callback);}},100);}},{key:\"componentDidMount\",value:function componentDidMount(){this.scrollToBottom();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.scrollToBottom();}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(newProps){var _this3=this;if(this.props.match.params.chatID!==newProps.match.params.chatID){WebSocketInstance.disconnect();this.waitForSocketConnection(function(){WebSocketInstance.fetchMessages(_this3.props.username,newProps.match.params.chatID);});WebSocketInstance.connect(newProps.match.params.chatID);}}},{key:\"render\",value:function render(){var _this4=this;var messages=this.state.messages;return/*#__PURE__*/React.createElement(Hoc,null,/*#__PURE__*/React.createElement(Profile,{id:this.props.match.params.chatID}),console.log(this.message),/*#__PURE__*/React.createElement(\"div\",{className:\"messages\"},/*#__PURE__*/React.createElement(\"ul\",{id:\"chat-log\"},this.props.messages&&this.renderMessages(this.props.messages),/*#__PURE__*/React.createElement(\"div\",{style:{float:\"left\",clear:\"both\"},ref:function ref(el){_this4.messagesEnd=el;}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"message-input\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.sendMessageHandler},/*#__PURE__*/React.createElement(\"div\",{className:\"wrap\"},/*#__PURE__*/React.createElement(\"input\",{onChange:this.messageChangeHandler,value:this.state.message,required:true,id:\"chat-message-input\",type:\"text\",placeholder:\"Write your message...\"}),/*#__PURE__*/React.createElement(\"button\",{style:{width:'90px',paddingTop:'20px'},id:\"chat-message-submit\",className:\"submit\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-paper-plane\",\"aria-hidden\":\"true\"}))))));}}]);return Chat;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{username:state.auth.username,messages:state.message.messages};};export default connect(mapStateToProps)(Chat);","map":{"version":3,"sources":["E:/Programming/React/For Merging Chat-App/proj/src/containers/Chat.js"],"names":["React","connect","WebSocketInstance","Hoc","Profile","groupUser","singleUser","axios","Chat","waitForSocketConnection","fetchMessages","props","username","match","params","chatID","state","message","value","messageChangeHandler","event","setState","target","sendMessageHandler","e","preventDefault","messageObject","from","content","chatId","newChatMessage","renderTimestamp","timestamp","prefix","timeDiff","Math","round","Date","getTime","getUserName","name","index","lastIndexOf","substr","renderMessages","messages","currentUser","map","i","arr","id","marginBottom","length","author","scrollToBottom","messagesEnd","scrollIntoView","behavior","replaceAll","string","search","replace","split","join","getImageURL","url","token","localStorage","getItem","defaults","headers","Authorization","get","then","res","data","photo_url","catch","getImage","itemNO","undefined","charAt","toUpperCase","slice","toLowerCase","initialiseChat","callback","component","setTimeout","console","log","newProps","disconnect","float","clear","el","width","paddingTop","Component","mapStateToProps","auth"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport WebSocketInstance from \"../websocket\";\r\nimport Hoc from \"../hoc/hoc\";\r\nimport Profile from \"./Profile\";\r\nimport groupUser from './../assets/groupUser.png'\r\nimport singleUser from './../assets/singleUser.png'\r\nimport axios from \"axios\";\r\n\r\nclass Chat extends React.Component {\r\n  state = {\r\n    message: \"\",\r\n    value:''\r\n  };\r\n\r\n  initialiseChat() {\r\n    this.waitForSocketConnection(() => {\r\n      // WebSocketInstance.addCallbacks(\r\n      //   this.props.setMessages.bind(this),\r\n      //   this.props.addMessage.bind(this)\r\n      // );\r\n      WebSocketInstance.fetchMessages(\r\n        this.props.username,\r\n        this.props.match.params.chatID\r\n      );\r\n    });\r\n    WebSocketInstance.connect(this.props.match.params.chatID);\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.initialiseChat();\r\n  }\r\n\r\n  waitForSocketConnection(callback) {\r\n    const component = this;\r\n    setTimeout(function() {\r\n      if (WebSocketInstance.state() === 1) {\r\n        console.log(\"Connection is made\");\r\n        callback();\r\n        return;\r\n      } else {\r\n        console.log(\"wait for connection...\");\r\n        component.waitForSocketConnection(callback);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  messageChangeHandler = event => {\r\n    this.setState({ message: event.target.value});\r\n  };\r\n\r\n  sendMessageHandler = e => {\r\n    e.preventDefault();\r\n    const messageObject = {\r\n      from: this.props.username,\r\n      content: this.state.message,\r\n      chatId: this.props.match.params.chatID\r\n    };\r\n    WebSocketInstance.newChatMessage(messageObject);\r\n    this.setState({ message: \"\" });\r\n  };\r\n\r\n  renderTimestamp = timestamp => {\r\n    let prefix = \"\";\r\n    const timeDiff = Math.round(\r\n      (new Date().getTime() - new Date(timestamp).getTime()) / 60000\r\n    );\r\n    if (timeDiff < 1) {\r\n      // less than one minute ago\r\n      prefix = \"just now...\";\r\n    } else if (timeDiff < 60 && timeDiff > 1) {\r\n      // less than sixty minutes ago\r\n      prefix = `${timeDiff} minutes ago`;\r\n    } else if (timeDiff < 24 * 60 && timeDiff > 60) {\r\n      // less than 24 hours ago\r\n      prefix = `${Math.round(timeDiff / 60)} hours ago`;\r\n    } else if (timeDiff < 31 * 24 * 60 && timeDiff > 24 * 60) {\r\n      // less than 7 days ago\r\n      prefix = `${Math.round(timeDiff / (60 * 24))} days ago`;\r\n    } else {\r\n\r\n    }\r\n    return prefix;\r\n  };\r\n\r\n  getUserName = (name) => {\r\n    var index = name.lastIndexOf('@')\r\n    name = name.substr(0, index) + '    @' + name.substr(index + 1);\r\n  \r\n    return name\r\n  }\r\n  renderMessages = messages => {\r\n    const currentUser = this.props.username;\r\n    return messages.map((message, i, arr) => (\r\n      <li\r\n        key={message.id}\r\n        style={{ marginBottom: arr.length - 1 === i ? \"300px\" : \"15px\" }}\r\n        className={message.author === currentUser ? \"sent\" : \"replies\"}\r\n      >\r\n        <p>\r\n        {this.getUserName(message.content)}\r\n          <br />\r\n          <small>{this.renderTimestamp(message.timestamp)}</small>\r\n        </p>\r\n      </li>\r\n    ));\r\n  };\r\n\r\n  scrollToBottom = () => {\r\n    this.messagesEnd.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  componentWillReceiveProps(newProps) {\r\n    if (this.props.match.params.chatID !== newProps.match.params.chatID) {\r\n      WebSocketInstance.disconnect();\r\n      this.waitForSocketConnection(() => {\r\n        WebSocketInstance.fetchMessages(\r\n          this.props.username,\r\n          newProps.match.params.chatID\r\n        );\r\n      }); \r\n      WebSocketInstance.connect(newProps.match.params.chatID);\r\n    }\r\n  }\r\n\r\n  replaceAll=(string, search, replace)=> {\r\n    return string.split(search).join(replace);\r\n  }\r\n\r\n  getImageURL = (name) => {\r\n    var url=''\r\n    var token = localStorage.getItem('token')\r\n    axios.defaults.headers = {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Token ${token}`\r\n    };\r\n    axios\r\n      .get(`http://127.0.0.1:8000/chat/profile/${name}`)\r\n      .then(res => res.data)\r\n      .then(res => {\r\n        this.setState({value:res[0].photo_url})\r\n        // url = res[0].photo_url\r\n      })\r\n      .catch() \r\n \r\n      return this.state.value\r\n    \r\n  }\r\n\r\n\r\n\r\n  getImage = () =>\r\n  {   \r\n    var itemNO = this.props.match.params.chatID.split('_').length\r\n    var name = this.props.match.params.chatID\r\n    name = this.replaceAll(name, '_', ' ')\r\n    var username = localStorage.getItem('username')\r\n    if (username !== null & username !== undefined)\r\n    {\r\n      username = localStorage.getItem('username').charAt(0).toUpperCase() + username.slice(1)  \r\n    }\r\n    if (itemNO <= 2)\r\n    {\r\n      name = name.replace(username, '')\r\n      name = this.replaceAll(name,' ', '')\r\n      name = name.toLowerCase()\r\n      name=this.getImageURL(name) \r\n    }\r\n    else {\r\n      name=groupUser\r\n    }\r\n    if (name === undefined)\r\n    {\r\n      name = singleUser  \r\n    }\r\n    \r\n    return name\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n    const messages = this.state.messages;\r\n    return (\r\n\r\n      <Hoc>\r\n        <Profile id={this.props.match.params.chatID} />\r\n         {console.log(this.message)}\r\n        <div className=\"messages\">\r\n          <ul id=\"chat-log\">\r\n            {this.props.messages && this.renderMessages(this.props.messages)}\r\n            <div\r\n              style={{ float: \"left\", clear: \"both\" }}\r\n              ref={el => {\r\n                this.messagesEnd = el;\r\n              }}\r\n            />\r\n          </ul>\r\n        </div>\r\n        <div className=\"message-input\">\r\n          <form onSubmit={this.sendMessageHandler}>\r\n            <div className=\"wrap\">\r\n              <input\r\n                onChange={this.messageChangeHandler}\r\n                value={this.state.message}\r\n                required\r\n                id=\"chat-message-input\"\r\n                type=\"text\"\r\n                placeholder=\"Write your message...\"\r\n              />\r\n               {/* <i className=\"fa fa-paperclip attachment\" aria-hidden=\"true\" /> */}\r\n              <button style={{width:'90px',paddingTop:'20px'}} id=\"chat-message-submit\" className=\"submit\">\r\n                <i className=\"fa fa-paper-plane\" aria-hidden=\"true\" />\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </Hoc>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    username: state.auth.username,\r\n    messages: state.message.messages,\r\n\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Chat);\r\n"]},"metadata":{},"sourceType":"module"}