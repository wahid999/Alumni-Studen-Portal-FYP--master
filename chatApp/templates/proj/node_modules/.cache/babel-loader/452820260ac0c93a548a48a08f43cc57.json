{"ast":null,"code":"import _classCallCheck from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\Programming\\\\React\\\\For Merging Chat-App\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{connect}from\"react-redux\";import WebSocketInstance from\"../websocket\";import Hoc from\"../hoc/hoc\";import Profile from\"./Profile\";var Chat=/*#__PURE__*/function(_React$Component){_inherits(Chat,_React$Component);var _super=_createSuper(Chat);_createClass(Chat,[{key:\"initialiseChat\",value:function initialiseChat(){var _this2=this;this.waitForSocketConnection(function(){// WebSocketInstance.addCallbacks(\n//   this.props.setMessages.bind(this),\n//   this.props.addMessage.bind(this)\n// );\nWebSocketInstance.fetchMessages(_this2.props.username,_this2.props.match.params.chatID);});WebSocketInstance.connect(this.props.match.params.chatID);}}]);function Chat(props){var _this;_classCallCheck(this,Chat);_this=_super.call(this,props);_this.state={message:\"\"};_this.messageChangeHandler=function(event){_this.setState({message:event.target.value});};_this.sendMessageHandler=function(e){e.preventDefault();var messageObject={from:_this.props.username,content:_this.state.message,chatId:_this.props.match.params.chatID};WebSocketInstance.newChatMessage(messageObject);_this.setState({message:\"\"});};_this.renderTimestamp=function(timestamp){var prefix=\"\";var timeDiff=Math.round((new Date().getTime()-new Date(timestamp).getTime())/60000);if(timeDiff<1){// less than one minute ago\nprefix=\"just now...\";}else if(timeDiff<60&&timeDiff>1){// less than sixty minutes ago\nprefix=\"\".concat(timeDiff,\" minutes ago\");}else if(timeDiff<24*60&&timeDiff>60){// less than 24 hours ago\nprefix=\"\".concat(Math.round(timeDiff/60),\" hours ago\");}else if(timeDiff<31*24*60&&timeDiff>24*60){// less than 7 days ago\nprefix=\"\".concat(Math.round(timeDiff/(60*24)),\" days ago\");}else{prefix=\"\".concat(new Date(timestamp));}return prefix;};_this.renderMessages=function(messages){var currentUser=_this.props.username;return messages.map(function(message,i,arr){return/*#__PURE__*/React.createElement(\"li\",{key:message.id,style:{marginBottom:arr.length-1===i?\"300px\":\"15px\"},className:message.author===currentUser?\"sent\":\"replies\"},/*#__PURE__*/React.createElement(\"img\",{src:\"http://emilcarlsson.se/assets/mikeross.png\"}),/*#__PURE__*/React.createElement(\"p\",null,message.content,/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"small\",null,_this.renderTimestamp(message.timestamp))));});};_this.scrollToBottom=function(){_this.messagesEnd.scrollIntoView({behavior:\"smooth\"});};_this.initialiseChat();return _this;}_createClass(Chat,[{key:\"waitForSocketConnection\",value:function waitForSocketConnection(callback){var component=this;setTimeout(function(){if(WebSocketInstance.state()===1){console.log(\"Connection is made\");callback();return;}else{console.log(\"wait for connection...\");component.waitForSocketConnection(callback);}},100);}// addMessage(message) {\n//   this.setState({ messages: [...this.state.messages, message] });\n// }\n// setMessages(messages) {\n//   this.setState({ messages: messages.reverse() });\n// }\n},{key:\"componentDidMount\",value:function componentDidMount(){this.scrollToBottom();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.scrollToBottom();}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(newProps){var _this3=this;if(this.props.match.params.chatID!==newProps.match.params.chatID){WebSocketInstance.disconnect();this.waitForSocketConnection(function(){WebSocketInstance.fetchMessages(_this3.props.username,newProps.match.params.chatID);});WebSocketInstance.connect(newProps.match.params.chatID);}}},{key:\"render\",value:function render(){var _this4=this;var messages=this.state.messages;return/*#__PURE__*/React.createElement(Hoc,null,/*#__PURE__*/React.createElement(Profile,{id:this.props.match.params.chatID}),/*#__PURE__*/React.createElement(\"div\",{className:\"messages\"},/*#__PURE__*/React.createElement(\"ul\",{id:\"chat-log\"},this.props.messages&&this.renderMessages(this.props.messages),/*#__PURE__*/React.createElement(\"div\",{style:{float:\"left\",clear:\"both\"},ref:function ref(el){_this4.messagesEnd=el;}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"message-input\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.sendMessageHandler},/*#__PURE__*/React.createElement(\"div\",{className:\"wrap\"},/*#__PURE__*/React.createElement(\"input\",{onChange:this.messageChangeHandler,value:this.state.message,required:true,id:\"chat-message-input\",type:\"text\",placeholder:\"Write your message...\"}),/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-paperclip attachment\",\"aria-hidden\":\"true\"}),/*#__PURE__*/React.createElement(\"button\",{id:\"chat-message-submit\",className:\"submit\"},/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-paper-plane\",\"aria-hidden\":\"true\"}))))));}}]);return Chat;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{username:state.auth.username,messages:state.message.messages};};export default connect(mapStateToProps)(Chat);","map":{"version":3,"sources":["E:/Programming/React/For Merging Chat-App/proj/src/containers/Chat.js"],"names":["React","connect","WebSocketInstance","Hoc","Profile","Chat","waitForSocketConnection","fetchMessages","props","username","match","params","chatID","state","message","messageChangeHandler","event","setState","target","value","sendMessageHandler","e","preventDefault","messageObject","from","content","chatId","newChatMessage","renderTimestamp","timestamp","prefix","timeDiff","Math","round","Date","getTime","renderMessages","messages","currentUser","map","i","arr","id","marginBottom","length","author","scrollToBottom","messagesEnd","scrollIntoView","behavior","initialiseChat","callback","component","setTimeout","console","log","newProps","disconnect","float","clear","el","Component","mapStateToProps","auth"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport WebSocketInstance from \"../websocket\";\r\nimport Hoc from \"../hoc/hoc\";\r\nimport Profile from \"./Profile\";\r\n\r\nclass Chat extends React.Component {\r\n  state = { message: \"\" };\r\n\r\n  initialiseChat() {\r\n    this.waitForSocketConnection(() => {\r\n      // WebSocketInstance.addCallbacks(\r\n      //   this.props.setMessages.bind(this),\r\n      //   this.props.addMessage.bind(this)\r\n      // );\r\n      WebSocketInstance.fetchMessages(\r\n        this.props.username,\r\n        this.props.match.params.chatID\r\n      );\r\n    });\r\n    WebSocketInstance.connect(this.props.match.params.chatID);\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.initialiseChat();\r\n  }\r\n\r\n  waitForSocketConnection(callback) {\r\n    const component = this;\r\n    setTimeout(function() {\r\n      if (WebSocketInstance.state() === 1) {\r\n        console.log(\"Connection is made\");\r\n        callback();\r\n        return;\r\n      } else {\r\n        console.log(\"wait for connection...\");\r\n        component.waitForSocketConnection(callback);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  // addMessage(message) {\r\n  //   this.setState({ messages: [...this.state.messages, message] });\r\n  // }\r\n\r\n  // setMessages(messages) {\r\n  //   this.setState({ messages: messages.reverse() });\r\n  // }\r\n\r\n  messageChangeHandler = event => {\r\n    this.setState({ message: event.target.value });\r\n  };\r\n\r\n  sendMessageHandler = e => {\r\n    e.preventDefault();\r\n    const messageObject = {\r\n      from: this.props.username,\r\n      content: this.state.message,\r\n      chatId: this.props.match.params.chatID\r\n    };\r\n    WebSocketInstance.newChatMessage(messageObject);\r\n    this.setState({ message: \"\" });\r\n  };\r\n\r\n  renderTimestamp = timestamp => {\r\n    let prefix = \"\";\r\n    const timeDiff = Math.round(\r\n      (new Date().getTime() - new Date(timestamp).getTime()) / 60000\r\n    );\r\n    if (timeDiff < 1) {\r\n      // less than one minute ago\r\n      prefix = \"just now...\";\r\n    } else if (timeDiff < 60 && timeDiff > 1) {\r\n      // less than sixty minutes ago\r\n      prefix = `${timeDiff} minutes ago`;\r\n    } else if (timeDiff < 24 * 60 && timeDiff > 60) {\r\n      // less than 24 hours ago\r\n      prefix = `${Math.round(timeDiff / 60)} hours ago`;\r\n    } else if (timeDiff < 31 * 24 * 60 && timeDiff > 24 * 60) {\r\n      // less than 7 days ago\r\n      prefix = `${Math.round(timeDiff / (60 * 24))} days ago`;\r\n    } else {\r\n      prefix = `${new Date(timestamp)}`;\r\n    }\r\n    return prefix;\r\n  };\r\n\r\n  renderMessages = messages => {\r\n    const currentUser = this.props.username;\r\n    return messages.map((message, i, arr) => (\r\n      <li\r\n        key={message.id}\r\n        style={{ marginBottom: arr.length - 1 === i ? \"300px\" : \"15px\" }}\r\n        className={message.author === currentUser ? \"sent\" : \"replies\"}\r\n      >\r\n        <img src=\"http://emilcarlsson.se/assets/mikeross.png\" />\r\n        <p>\r\n          {message.content}\r\n          <br />\r\n          <small>{this.renderTimestamp(message.timestamp)}</small>\r\n        </p>\r\n      </li>\r\n    ));\r\n  };\r\n\r\n  scrollToBottom = () => {\r\n    this.messagesEnd.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  componentWillReceiveProps(newProps) {\r\n    if (this.props.match.params.chatID !== newProps.match.params.chatID) {\r\n      WebSocketInstance.disconnect();\r\n      this.waitForSocketConnection(() => {\r\n        WebSocketInstance.fetchMessages(\r\n          this.props.username,\r\n          newProps.match.params.chatID\r\n        );\r\n      });\r\n      WebSocketInstance.connect(newProps.match.params.chatID);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const messages = this.state.messages;\r\n    return (\r\n\r\n      <Hoc>\r\n        <Profile  id={this.props.match.params.chatID} />\r\n        <div className=\"messages\">\r\n          <ul id=\"chat-log\">\r\n            {this.props.messages && this.renderMessages(this.props.messages)}\r\n            <div\r\n              style={{ float: \"left\", clear: \"both\" }}\r\n              ref={el => {\r\n                this.messagesEnd = el;\r\n              }}\r\n            />\r\n          </ul>\r\n        </div>\r\n        <div className=\"message-input\">\r\n          <form onSubmit={this.sendMessageHandler}>\r\n            <div className=\"wrap\">\r\n              <input\r\n                onChange={this.messageChangeHandler}\r\n                value={this.state.message}\r\n                required\r\n                id=\"chat-message-input\"\r\n                type=\"text\"\r\n                placeholder=\"Write your message...\"\r\n              />\r\n              <i className=\"fa fa-paperclip attachment\" aria-hidden=\"true\" />\r\n              <button id=\"chat-message-submit\" className=\"submit\">\r\n                <i className=\"fa fa-paper-plane\" aria-hidden=\"true\" />\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </Hoc>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    username: state.auth.username,\r\n    messages: state.message.messages,\r\n\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Chat);\r\n"]},"metadata":{},"sourceType":"module"}