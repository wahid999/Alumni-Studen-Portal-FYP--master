{"ast":null,"code":"import _objectSpread from\"E:\\\\Uni\\\\8th Sem\\\\FYP\\\\fyp\\\\chatApp\\\\templates\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"E:\\\\Uni\\\\8th Sem\\\\FYP\\\\fyp\\\\chatApp\\\\templates\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"E:\\\\Uni\\\\8th Sem\\\\FYP\\\\fyp\\\\chatApp\\\\templates\\\\proj\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";var WebSocketService=/*#__PURE__*/function(){_createClass(WebSocketService,null,[{key:\"getInstance\",value:function getInstance(){if(!WebSocketService.instance){WebSocketService.instance=new WebSocketService();}return WebSocketService.instance;}}]);function WebSocketService(){_classCallCheck(this,WebSocketService);this.callbacks={};this.socketRef=null;}_createClass(WebSocketService,[{key:\"connect\",value:function connect(chatUrl){var _this=this;var path=\"ws://127.0.0.1:8000/ws/chat/\".concat(chatUrl,\"/\");this.socketRef=new WebSocket(path);this.socketRef.onopen=function(){console.log(\"WebSocket open\");};this.socketRef.onmessage=function(e){_this.socketNewMessage(e.data);};this.socketRef.onerror=function(e){console.log(e.message);};this.socketRef.onclose=function(){console.log(\"WebSocket closed let's reopen\");_this.connect();};}},{key:\"disconnect\",value:function disconnect(){this.socketRef.close();}},{key:\"socketNewMessage\",value:function socketNewMessage(data){var parsedData=JSON.parse(data);var command=parsedData.command;if(Object.keys(this.callbacks).length===0){return;}if(command===\"messages\"){this.callbacks[command](parsedData.messages);}if(command===\"new_message\"){this.callbacks[command](parsedData.message);}}},{key:\"fetchMessages\",value:function fetchMessages(username,chatId){this.sendMessage({command:\"fetch_messages\",username:username,chatId:chatId});}},{key:\"newChatMessage\",value:function newChatMessage(message){this.sendMessage({command:\"new_message\",from:message.from,message:message.content,chatId:message.chatId});}},{key:\"addCallbacks\",value:function addCallbacks(messagesCallback,newMessageCallback){this.callbacks[\"messages\"]=messagesCallback;this.callbacks[\"new_message\"]=newMessageCallback;}},{key:\"sendMessage\",value:function sendMessage(data){try{this.socketRef.send(JSON.stringify(_objectSpread({},data)));}catch(err){console.log(err.message);}}},{key:\"state\",value:function state(){return this.socketRef.readyState;}}]);return WebSocketService;}();WebSocketService.instance=null;var WebSocketInstance=WebSocketService.getInstance();export default WebSocketInstance;","map":{"version":3,"sources":["E:/Uni/8th Sem/FYP/fyp/chatApp/templates/proj/src/websocket.js"],"names":["WebSocketService","instance","callbacks","socketRef","chatUrl","path","WebSocket","onopen","console","log","onmessage","e","socketNewMessage","data","onerror","message","onclose","connect","close","parsedData","JSON","parse","command","Object","keys","length","messages","username","chatId","sendMessage","from","content","messagesCallback","newMessageCallback","send","stringify","err","readyState","WebSocketInstance","getInstance"],"mappings":"ghBAAMA,CAAAA,gB,4GAIiB,CACnB,GAAI,CAACA,gBAAgB,CAACC,QAAtB,CAAgC,CAC9BD,gBAAgB,CAACC,QAAjB,CAA4B,GAAID,CAAAA,gBAAJ,EAA5B,CACD,CACD,MAAOA,CAAAA,gBAAgB,CAACC,QAAxB,CACD,C,IAED,2BAAc,6CATdC,SASc,CATF,EASE,CACZ,KAAKC,SAAL,CAAiB,IAAjB,CACD,C,qEAEOC,O,CAAS,gBACf,GAAMC,CAAAA,IAAI,uCAAkCD,OAAlC,KAAV,CACA,KAAKD,SAAL,CAAiB,GAAIG,CAAAA,SAAJ,CAAcD,IAAd,CAAjB,CACA,KAAKF,SAAL,CAAeI,MAAf,CAAwB,UAAM,CAC5BC,OAAO,CAACC,GAAR,CAAY,gBAAZ,EACD,CAFD,CAGA,KAAKN,SAAL,CAAeO,SAAf,CAA2B,SAAAC,CAAC,CAAI,CAC9B,KAAI,CAACC,gBAAL,CAAsBD,CAAC,CAACE,IAAxB,EACD,CAFD,CAGA,KAAKV,SAAL,CAAeW,OAAf,CAAyB,SAAAH,CAAC,CAAI,CAC5BH,OAAO,CAACC,GAAR,CAAYE,CAAC,CAACI,OAAd,EACD,CAFD,CAGA,KAAKZ,SAAL,CAAea,OAAf,CAAyB,UAAM,CAC7BR,OAAO,CAACC,GAAR,CAAY,+BAAZ,EACA,KAAI,CAACQ,OAAL,GACD,CAHD,CAID,C,+CAEY,CACX,KAAKd,SAAL,CAAee,KAAf,GACD,C,0DAEgBL,I,CAAM,CACrB,GAAMM,CAAAA,UAAU,CAAGC,IAAI,CAACC,KAAL,CAAWR,IAAX,CAAnB,CACA,GAAMS,CAAAA,OAAO,CAAGH,UAAU,CAACG,OAA3B,CACA,GAAIC,MAAM,CAACC,IAAP,CAAY,KAAKtB,SAAjB,EAA4BuB,MAA5B,GAAuC,CAA3C,CAA8C,CAC5C,OACD,CACD,GAAIH,OAAO,GAAK,UAAhB,CAA4B,CAC1B,KAAKpB,SAAL,CAAeoB,OAAf,EAAwBH,UAAU,CAACO,QAAnC,EACD,CACD,GAAIJ,OAAO,GAAK,aAAhB,CAA+B,CAC7B,KAAKpB,SAAL,CAAeoB,OAAf,EAAwBH,UAAU,CAACJ,OAAnC,EACD,CACF,C,oDAEaY,Q,CAAUC,M,CAAQ,CAC9B,KAAKC,WAAL,CAAiB,CACfP,OAAO,CAAE,gBADM,CAEfK,QAAQ,CAAEA,QAFK,CAGfC,MAAM,CAAEA,MAHO,CAAjB,EAKD,C,sDAEcb,O,CAAS,CACtB,KAAKc,WAAL,CAAiB,CACfP,OAAO,CAAE,aADM,CAEfQ,IAAI,CAAEf,OAAO,CAACe,IAFC,CAGff,OAAO,CAAEA,OAAO,CAACgB,OAHF,CAIfH,MAAM,CAAEb,OAAO,CAACa,MAJD,CAAjB,EAMD,C,kDAEYI,gB,CAAkBC,kB,CAAoB,CACjD,KAAK/B,SAAL,CAAe,UAAf,EAA6B8B,gBAA7B,CACA,KAAK9B,SAAL,CAAe,aAAf,EAAgC+B,kBAAhC,CACD,C,gDAEWpB,I,CAAM,CAChB,GAAI,CACF,KAAKV,SAAL,CAAe+B,IAAf,CAAoBd,IAAI,CAACe,SAAL,kBAAoBtB,IAApB,EAApB,EACD,CAAC,MAAOuB,GAAP,CAAY,CACZ5B,OAAO,CAACC,GAAR,CAAY2B,GAAG,CAACrB,OAAhB,EACD,CACF,C,qCAEO,CACN,MAAO,MAAKZ,SAAL,CAAekC,UAAtB,CACD,C,gCAnFGrC,gB,CACGC,Q,CAAW,I,CAqFpB,GAAMqC,CAAAA,iBAAiB,CAAGtC,gBAAgB,CAACuC,WAAjB,EAA1B,CAEA,cAAeD,CAAAA,iBAAf","sourcesContent":["class WebSocketService {\r\n  static instance = null;\r\n  callbacks = {};\r\n\r\n  static getInstance() {\r\n    if (!WebSocketService.instance) {\r\n      WebSocketService.instance = new WebSocketService();\r\n    }\r\n    return WebSocketService.instance;\r\n  }\r\n\r\n  constructor() {\r\n    this.socketRef = null;\r\n  }\r\n\r\n  connect(chatUrl) {\r\n    const path = `ws://127.0.0.1:8000/ws/chat/${chatUrl}/`;\r\n    this.socketRef = new WebSocket(path);\r\n    this.socketRef.onopen = () => {\r\n      console.log(\"WebSocket open\");\r\n    };\r\n    this.socketRef.onmessage = e => {\r\n      this.socketNewMessage(e.data);\r\n    };\r\n    this.socketRef.onerror = e => {\r\n      console.log(e.message);\r\n    };\r\n    this.socketRef.onclose = () => {\r\n      console.log(\"WebSocket closed let's reopen\");\r\n      this.connect();\r\n    };\r\n  }\r\n\r\n  disconnect() {\r\n    this.socketRef.close();\r\n  }\r\n\r\n  socketNewMessage(data) {\r\n    const parsedData = JSON.parse(data);\r\n    const command = parsedData.command;\r\n    if (Object.keys(this.callbacks).length === 0) {\r\n      return;\r\n    }\r\n    if (command === \"messages\") {\r\n      this.callbacks[command](parsedData.messages);\r\n    }\r\n    if (command === \"new_message\") {\r\n      this.callbacks[command](parsedData.message);\r\n    }\r\n  }\r\n\r\n  fetchMessages(username, chatId) {\r\n    this.sendMessage({\r\n      command: \"fetch_messages\",\r\n      username: username,\r\n      chatId: chatId\r\n    });\r\n  }\r\n\r\n  newChatMessage(message) {\r\n    this.sendMessage({\r\n      command: \"new_message\",\r\n      from: message.from,\r\n      message: message.content,\r\n      chatId: message.chatId\r\n    });\r\n  }\r\n\r\n  addCallbacks(messagesCallback, newMessageCallback) {\r\n    this.callbacks[\"messages\"] = messagesCallback;\r\n    this.callbacks[\"new_message\"] = newMessageCallback;\r\n  }\r\n\r\n  sendMessage(data) {\r\n    try {\r\n      this.socketRef.send(JSON.stringify({ ...data }));\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n  }\r\n\r\n  state() {\r\n    return this.socketRef.readyState;\r\n  }\r\n}\r\n\r\nconst WebSocketInstance = WebSocketService.getInstance();\r\n\r\nexport default WebSocketInstance;\r\n"]},"metadata":{},"sourceType":"module"}